description = 'Emoji SVG fonts resource'

// This module only contains the emoji.zip resource file
// It should only be built when emoji fonts need to be updated

publishing {
    publications {
        maven(MavenPublication) {
            pom {
                description = 'Emoji SVG fonts resource'
                url = 'https://github.com/mimidesunya/pdfg2d/tree/main/pdfg2d-svg-emoji'
                
                scm {
                    connection = 'scm:git:https://github.com/mimidesunya/pdfg2d/tree/main/pdfg2d-svg-emoji'
                    developerConnection = 'scm:git:https://github.com/mimidesunya/pdfg2d/tree/main/pdfg2d-svg-emoji'
                    url = 'https://github.com/mimidesunya/pdfg2d/tree/main/pdfg2d-svg-emoji'
                }
            }
        }
    }
}

task setupEmoji(type: Exec) {
    def toolFile = file("BuildEmojiIndexTool.java")
    def emojiZip = file("src/main/resources/net/zamasoft/pdfg2d/font/emoji/emoji.zip")
    
    // Define inputs and outputs for incremental build support
    inputs.file toolFile
    outputs.file emojiZip
    
    workingDir projectDir
    commandLine 'cmd', '/c', 'javac -encoding UTF-8 BuildEmojiIndexTool.java && java -cp . BuildEmojiIndexTool'
    
    // Only run if emoji.zip doesn't exist or tool source changed
    onlyIf { !emojiZip.exists() || toolFile.lastModified() > emojiZip.lastModified() }
}

// Ensure emoji.zip is generated before processing resources
processResources.dependsOn setupEmoji
